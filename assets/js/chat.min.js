var time=0,BASE_URL="/chat/",updateTime=function(e){$.getJSON("time",function(t){e(t)})},sendChat=function(e,t){var n=encodeURIComponent(e);$.getJSON(BASE_URL+"chat/insert_chat?message="+n,function(e){t()})},addDataToReceived=function(e){e.forEach(function(e){$("#received").append("<p>"+e[0]+"</p>")})},getNewChats=function(){$.getJSON(BASE_URL+"chat/get_chats?time="+time,function(e){addDataToReceived(e),setTimeout(function(){$("#received").scrollTop($("#received")[0].scrollHeight)},0),e.length>0&&(time=e[e.length-1][1])}).done(function(){})};$(document).ready(function(){$("form").submit(function(e){e.preventDefault();var t=$("#text").val();$("#text").val(""),sendChat(t,function(){})}),setInterval(function(){getNewChats(0)},1200)});
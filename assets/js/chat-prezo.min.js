var time=0,sendChat=function(e,t){var c=encodeURIComponent(e);$.getJSON("chat/insert_chat?message="+c,function(e){t()})},addDataToReceived=function(e){e.forEach(function(e){$("#received").append("<p>"+e[0]+"</p>")})},getNewChats=function(){$.getJSON("chat/get_chats?time="+time,function(e){addDataToReceived(e),setTimeout(function(){},0),e.length>0&&(time=e[e.length-1][1])})};$(document).ready(function(){var e=$(window).height();$("#received").height(e),$("form").submit(function(e){e.preventDefault();var t=$("#text").val();$("#text").val(""),sendChat(t,function(){})}),setInterval(function(){getNewChats(0);var e=$("#received").height();console.log($("#received").scrollTop()+e),console.log($("#received")[0].scrollHeight),$("#received").scrollTop()+e+100>=$("#received")[0].scrollHeight&&$("#received").scrollTop($("#received")[0].scrollHeight)},1200)});